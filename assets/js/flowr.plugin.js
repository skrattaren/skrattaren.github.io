!function(a){a.fn.flowr=function(d){$this=this;var e=["complete","data","responsive"],c={data:[],padding:5,height:240,render:null,append:!1,widthAttr:"width",heightAttr:"height",maxScale:1.5,maxWidth:this.width()-1,itemWidth:null,itemHeight:null,complete:null,rowClassName:"flowr-row",rows:-1,responsive:!0},b=a.extend(c,d);if(b.append&&$this.data("lastSettings")){for(attr in lastSettings=$this.data("lastSettings"),c)0>e.indexOf(attr)&&b[attr]==c[attr]&&(b[attr]=lastSettings[attr]);(lastRow=$this.data("lastRow")).data.length>0&&b.maxWidth-lastRow.width>25&&(lastRowData=lastSettings.data.slice(lastSettings.data.length-lastRow.data.length-1),b.data=lastRowData.concat(b.data),a("."+b.rowClassName+":last",$this).detach())}if(b.responsive||b.append||$this.width($this.width()),b.data instanceof Array){"number"!=typeof b.padding&&(b.padding=parseInt(b.padding)),"function"!=typeof b.itemWidth&&(b.itemWidth=function(a){return a[b.widthAttr]}),"function"!=typeof b.itemHeight&&(b.itemHeight=function(a){return a[b.heightAttr]});var f={getNextRow:function(j,a){var g=0,k=j.length,d=[],c=0;for(a.maxWidth,a.padding,requiredPadding=function(){var b=1==arguments.length?arguments[0]:0;return(d.length-1+b)*a.padding};c+requiredPadding()<a.maxWidth&&g<k;){var h=j[g],l=a.itemWidth.call($this,h),m=a.itemHeight.call($this,h),i=a.height,b=Math.floor(l*a.height/m);b>a.maxWidth&&(b=a.maxWidth-1-requiredPadding(1),i=a.height*i/b);var n=c+b;if(n<a.maxWidth)d.push({height:i,width:b,itemData:h}),c+=b,g++;else break}if(testWidth=0,c<a.maxWidth){var e=(a.maxWidth-requiredPadding()-10)/c;e>a.maxScale&&(e=1);var o=Math.round(a.height*e);for(i=0;i<d.length;i++){var f=d[i];f.width=Math.floor(f.width*e),f.height=o,testWidth+=f.width}}return{data:d,width:testWidth+requiredPadding()}},reorderContent:function(){var b=$this.data("width"),c=$this.width();if(b!=c){$this.html("");var a=$this.data("lastSettings");a.data=$this.data("data"),a.maxWidth=$this.width()-1,$this.flowr(a)}}};return b.responsive&&!$this.data("__responsive")&&(a(window).resize(function(){if(initialWidth=$this.data("width"),newWidth=$this.width(),initialWidth!=newWidth){var a=$this.data("task_id");a&&(a=clearTimeout(a),a=null),a=setTimeout(f.reorderContent,80),$this.data("task_id",a)}}),$this.data("__responsive",!0)),this.each(function(){var d=b.data.slice(0),c=null,g=0,i=0,j=[];for(i=0;i<d.length;i++)j.push(d[i]);for($this.data("data",j);null!=(c=f.getNextRow(d,b))&&c.data.length>0&&(!(b.rows>0)||!(g>=b.rows));){d.splice(0,c.data.length);var k=a("<div>").addClass(b.rowClassName),l=$this[0].clientWidth-c.width-2*b.padding;for(i=0;i<c.data.length;i++){var h=c.data[i],e=b.render.call($this,h);e=a(e),extraw=Math.floor(l/c.data.length),0==i&&(extraw+=l%c.data.length),e.css("width",h.width+extraw).css("height",h.height).css("margin-bottom",b.padding+"px").css("margin-left",0==i?"0":b.padding+"px"),k.append(e),i++}$this.append(k),g++,$this.data("lastRow",c)}if($this.data("lastSettings",b),"function"==typeof b.complete){var m={renderedRows:g,renderedItems:i};b.complete.call($this,m)}})}}}(jQuery)