!function($){$.fn.flowr=function(c){$this=this;var d=["complete","data","responsive"],b={data:[],padding:5,height:240,render:null,append:!1,widthAttr:"width",heightAttr:"height",maxScale:1.5,maxWidth:this.width()-1,itemWidth:null,itemHeight:null,complete:null,rowClassName:"flowr-row",rows:-1,responsive:!0},a=$.extend(b,c);if(a.append&&$this.data("lastSettings")){for(attr in lastSettings=$this.data("lastSettings"),b)0>d.indexOf(attr)&&a[attr]==b[attr]&&(a[attr]=lastSettings[attr]);(lastRow=$this.data("lastRow")).data.length>0&&a.maxWidth-lastRow.width>25&&(lastRowData=lastSettings.data.slice(lastSettings.data.length-lastRow.data.length-1),a.data=lastRowData.concat(a.data),$("."+a.rowClassName+":last",$this).detach())}if(a.responsive||a.append||$this.width($this.width()),a.data instanceof Array){"number"!=typeof a.padding&&(a.padding=parseInt(a.padding)),"function"!=typeof a.itemWidth&&(a.itemWidth=function(b){return b[a.widthAttr]}),"function"!=typeof a.itemHeight&&(a.itemHeight=function(b){return b[a.heightAttr]});var e={getNextRow:function(j,a){var g=0,k=j.length,d=[],c=0;for(a.maxWidth,a.padding,requiredPadding=function(){var b=1==arguments.length?arguments[0]:0;return(d.length-1+b)*a.padding};c+requiredPadding()<a.maxWidth&&g<k;){var h=j[g],l=a.itemWidth.call($this,h),m=a.itemHeight.call($this,h),i=a.height,b=Math.floor(l*a.height/m);b>a.maxWidth&&(b=a.maxWidth-1-requiredPadding(1),i=a.height*i/b);var n=c+b;if(n<a.maxWidth)d.push({height:i,width:b,itemData:h}),c+=b,g++;else break}if(testWidth=0,c<a.maxWidth){var e=(a.maxWidth-requiredPadding()-10)/c;e>a.maxScale&&(e=1);var o=Math.round(a.height*e);for(i=0;i<d.length;i++){var f=d[i];f.width=Math.floor(f.width*e),f.height=o,testWidth+=f.width}}return{data:d,width:testWidth+requiredPadding()}},reorderContent:function(){var b=$this.data("width"),c=$this.width();if(b!=c){$this.html("");var a=$this.data("lastSettings");a.data=$this.data("data"),a.maxWidth=$this.width()-1,$this.flowr(a)}}};return a.responsive&&!$this.data("__responsive")&&($(window).resize(function(){if(initialWidth=$this.data("width"),newWidth=$this.width(),initialWidth!=newWidth){var a=$this.data("task_id");a&&(a=clearTimeout(a),a=null),a=setTimeout(e.reorderContent,80),$this.data("task_id",a)}}),$this.data("__responsive",!0)),this.each(function(){var c=a.data.slice(0),b=null,f=0,h=0,i=[];for(i=0;i<c.length;i++)i.push(c[i]);for($this.data("data",i);null!=(b=e.getNextRow(c,a))&&b.data.length>0&&(!(a.rows>0)||!(f>=a.rows));){c.splice(0,b.data.length);var j=$("<div>").addClass(a.rowClassName),k=$this[0].clientWidth-b.width-2*a.padding;for(i=0;i<b.data.length;i++){var g=b.data[i],d=a.render.call($this,g);d=$(d),extraw=Math.floor(k/b.data.length),0==i&&(extraw+=k%b.data.length),d.css("width",g.width+extraw).css("height",g.height).css("margin-bottom",a.padding+"px").css("margin-left",0==i?"0":a.padding+"px"),j.append(d),h++}$this.append(j),f++,$this.data("lastRow",b)}if($this.data("lastSettings",a),"function"==typeof a.complete){var l={renderedRows:f,renderedItems:h};a.complete.call($this,l)}})}}}(jQuery)