!function(t){t.fn.flowr=function(a){$this=this;var e=["complete","data","responsive"],d={data:[],padding:5,height:240,render:null,append:!1,widthAttr:"width",heightAttr:"height",maxScale:1.5,maxWidth:this.width()-1,itemWidth:null,itemHeight:null,complete:null,rowClassName:"flowr-row",rows:-1,responsive:!0},h=t.extend(d,a);if(h.append&&$this.data("lastSettings")){for(attr in lastSettings=$this.data("lastSettings"),d)e.indexOf(attr)<0&&h[attr]==d[attr]&&(h[attr]=lastSettings[attr]);lastRow=$this.data("lastRow"),lastRow.data.length>0&&h.maxWidth-lastRow.width>25&&(lastRowData=lastSettings.data.slice(lastSettings.data.length-lastRow.data.length-1),h.data=lastRowData.concat(h.data),t("."+h.rowClassName+":last",$this).detach())}if(h.responsive||h.append||$this.width($this.width()),h.data instanceof Array){"number"!=typeof h.padding&&(h.padding=parseInt(h.padding)),"function"!=typeof h.itemWidth&&(h.itemWidth=function(t){return t[h.widthAttr]}),"function"!=typeof h.itemHeight&&(h.itemHeight=function(t){return t[h.heightAttr]});var n=function(t,a){var e=0,d=t.length,h=[],n=0;a.maxWidth,a.padding;for(requiredPadding=function(){var t=1==arguments.length?arguments[0]:0;return(h.length-1+t)*a.padding};n+requiredPadding()<a.maxWidth&&e<d;){var s=t[e],r=a.itemWidth.call($this,s),l=a.itemHeight.call($this,s),o=a.height,g=Math.floor(r*a.height/l);if(g>a.maxWidth&&(g=a.maxWidth-1-requiredPadding(1),o=a.height*o/g),!(n+g<a.maxWidth))break;h.push({height:o,width:g,itemData:s}),n+=g,e++}if(testWidth=0,n<a.maxWidth){var w=(a.maxWidth-requiredPadding()-10)/n;w>a.maxScale&&(w=1);var f=Math.round(a.height*w);for(i=0;i<h.length;i++){var p=h[i];p.width=Math.floor(p.width*w),p.height=f,testWidth+=p.width}}return{data:h,width:testWidth+requiredPadding()}},s=function(){var t=$this.data("width"),i=$this.width();if(t!=i){$this.html("");var a=$this.data("lastSettings");a.data=$this.data("data"),a.maxWidth=$this.width()-1,$this.flowr(a)}};return h.responsive&&!$this.data("__responsive")&&(t(window).resize(function(){if(initialWidth=$this.data("width"),newWidth=$this.width(),initialWidth!=newWidth){var t=$this.data("task_id");t&&(t=clearTimeout(t),t=null),t=setTimeout(s,80),$this.data("task_id",t)}}),$this.data("__responsive",!0)),this.each(function(){var a=h.data.slice(0),e=null,d=0,s=0,r=[];for(i=0;i<a.length;i++)r.push(a[i]);for($this.data("data",r);null!=(e=n(a,h))&&e.data.length>0&&!(h.rows>0&&d>=h.rows);){a.splice(0,e.data.length);var l=t("<div>").addClass(h.rowClassName),o=$this[0].clientWidth-e.width-2*h.padding;for(i=0;i<e.data.length;i++){var g=e.data[i],w=h.render.call($this,g);w=t(w),extraw=Math.floor(o/e.data.length),0==i&&(extraw+=o%e.data.length),w.css("width",g.width+extraw).css("height",g.height).css("margin-bottom",h.padding+"px").css("margin-left",0==i?"0":h.padding+"px"),l.append(w),s++}$this.append(l),d++,$this.data("lastRow",e)}if($this.data("lastSettings",h),"function"==typeof h.complete){var f={renderedRows:d,renderedItems:s};h.complete.call($this,f)}})}}}(jQuery);